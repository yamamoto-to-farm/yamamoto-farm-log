<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>収穫ログ - 山本農園</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: sans-serif; padding: 20px; background:#f5f5f5; }
    h1 { margin-bottom: 16px; }
    h2 { margin-top: 24px; }
    .field { margin-bottom: 12px; }
    .field label { display:block; margin-bottom:4px; }
    .box { padding: 15px; border: 1px solid #ccc; margin-top: 10px; background:#fff; }
    input, select, textarea {
      width: 100%; padding: 8px; box-sizing: border-box; font-size: 14px;
    }
    button {
      width: 100%; padding: 12px; font-size: 16px;
      background: #2f855a; color: #fff; border: none; border-radius: 4px;
      margin-top: 20px;
    }
    button:active { opacity: 0.8; }

    #field_auto {
      background: #fff3b0;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <!-- ▼ harvest は PIN UI を持たない。未認証端末は index に戻す -->
  <div id="form-area" style="display:none;">

    <h1>収穫ログ</h1>

    <!-- 日付 -->
    <div class="field">
      <label for="harvestDate">収穫日</label>
      <input type="date" id="harvestDate">
    </div>

    <div class="field">
      <label for="shippingDate">出荷申請日</label>
      <input type="date" id="shippingDate">
    </div>

    <!-- 作業者 -->
    <h2>作業者</h2>
    <div class="box" id="workers_box"></div>

    <div class="box">
      <label for="temp_workers">単発バイト（カンマ区切り）</label>
      <input id="temp_workers" placeholder="例：佐藤さん, 田中さん">
    </div>

    <!-- 圃場 -->
    <h2>圃場</h2>
    <div class="box">

      <label>自動判定（推定）</label>
      <input id="field_auto" readonly>

      <label style="margin-top:10px;">
        <input type="checkbox" id="field_confirm">
        この圃場で確定する
      </label>

      <hr style="margin: 15px 0;">

      <label>エリア選択</label>
      <select id="field_area">
        <option value="">エリアを選択</option>
      </select>

      <label>圃場選択</label>
      <select id="field_manual">
        <option value="">エリアを選んでください</option>
      </select>
    </div>

    <!-- 紐づける定植記録 -->
    <h2>紐づける定植記録</h2>
    <div class="box">
      <label for="plantingRef">定植記録（収穫予定 ±1ヶ月）</label>
      <select id="plantingRef">
        <option value="">該当する定植記録を選択</option>
      </select>
    </div>

    <!-- 収穫量・特記事項 -->
    <h2>収穫量・特記事項</h2>
    <div class="box">
      <div class="field">
        <label for="amount">収穫量（基）</label>
        <input type="number" id="amount" inputmode="numeric">
      </div>
      <div class="field">
        <label for="issue">特記事項</label>
        <textarea id="issue" rows="3" placeholder="病害虫・欠株・その他メモなど"></textarea>
      </div>
    </div>

    <!-- 保存ボタン -->
    <button type="button" onclick="saveHarvest()">GitHub に保存する</button>

  </div><!-- /form-area -->

  <!-- JS -->
  <script type="module">
    // ★ localStorage → window.currentRole を復元
    import "/yamamoto-farm-log/common/ui.js";

    window.addEventListener("DOMContentLoaded", () => {

      // ★ 未認証端末は index に戻す
      if (!window.currentRole) {
        alert("アクセス権限がありません（PIN を入力してください）");
        location.href = "../index.html";
        return;
      }

      // harvest は worker も使えるのでロール制限なし
      document.getElementById("form-area").style.display = "block";

      // 日付初期値
      const today = new Date().toISOString().slice(0, 10);
      document.getElementById("harvestDate").value = today;
      document.getElementById("shippingDate").value = today;
    });
  </script>

  <script type="module" src="./harvest.js"></script>

</body>
</html>