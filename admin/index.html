<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理ページ - 山本農園</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: sans-serif; padding: 20px; background:#f5f5f5; }
    h1 { margin-bottom: 20px; }
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin-bottom: 16px;
    }
    .card a {
      color: #2b6cb0;
      font-weight: bold;
      text-decoration: none;
    }
  </style>
</head>

<body>

  <div id="admin-area" style="display:none;">
    <h1>管理ページ</h1>
    <div id="admin-list"></div>
  </div>

  <script type="module">
    import { verifyLocalAuth } from "/yamamoto-farm-log/common/ui.js";

    async function loadPages() {
      const res = await fetch("/yamamoto-farm-log/data/pages.json");
      return (await res.json()).pages;
    }

    window.addEventListener("DOMContentLoaded", async () => {

      // 認証チェック
      const ok = await verifyLocalAuth();
      if (!ok) return;

      // worker → アクセス禁止
      if (window.currentRole === "worker") {
        alert("このページは管理者のみアクセスできます");
        location.href = "../index.html";
        return;
      }

      // family/admin → 表示
      document.getElementById("admin-area").style.display = "block";

      // pages.json 読み込み
      const pages = await loadPages();

      // ★ 階層カテゴリ対応
      // 管理ページ自身（id: admin）は除外
      // 管理/〜 のツールだけ表示
      const adminTools = pages.filter(p =>
        p.category.startsWith("管理/") && p.id !== "admin"
      );

      const list = document.getElementById("admin-list");

      // カード生成
      adminTools.forEach(p => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<a href="${p.path}">${p.name}</a>`;
        list.appendChild(div);
      });
    });
  </script>

</body>
</html>