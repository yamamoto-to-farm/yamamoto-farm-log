<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>圃場マップ</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { margin: 0; }
    #map { height: 100vh; }
  </style>
</head>
<body>

  <!-- 認証後に表示される地図 -->
  <div id="map-container" style="display:none;">
    <div id="map"></div>
  </div>

  <script type="module">
    import { verifyLocalAuth } from "/yamamoto-farm-log/common/ui.js";
    import { initMap } from "./map.js";

    window.addEventListener("DOMContentLoaded", async () => {

      // ★ localStorage の認証情報が有効かチェック
      const ok = await verifyLocalAuth();
      if (!ok) return;   // 無効なら index.html に戻される

      // ★ 認証済み → 地図を表示
      document.getElementById("map-container").style.display = "block";

      // ★ Leaflet 初期化（display:block の後で実行）
      initMap();
    });
  </script>

</body>
</html>