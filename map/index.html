<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>圃場マップ</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { margin: 0; }
    #map { height: 100vh; }
  </style>
</head>
<body>

  <!-- 認証後に表示される地図 -->
  <div id="map-container" style="display:none;">
    <div id="map"></div>
  </div>

  <script type="module">
    // ★ localStorage → window.currentRole を復元
    import "/yamamoto-farm-log/common/ui.js";

    // ★ map.js の initMap を読み込む
    import { initMap } from "./map.js";

    window.addEventListener("DOMContentLoaded", () => {

      // ★ 未認証端末はトップページへ戻す
      if (!window.currentRole) {
        alert("アクセス権限がありません（PIN を入力してください）");
        location.href = "../index.html";
        return;
      }

      // ★ 認証済み → 地図を表示
      document.getElementById("map-container").style.display = "block";

      // ★ Leaflet 初期化（display:block の後で実行）
      initMap();
    });
  </script>

</body>
</html>