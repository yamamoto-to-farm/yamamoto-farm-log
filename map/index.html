<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>圃場マップ</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- ★ map.css を読み込む（必須） -->
  <link rel="stylesheet" href="map.css?v=1">

  <style>
    body { margin: 0; }

    /* 上部の選択リストエリア */
    #field-select-container {
      padding: 10px;
      background: #f5f5f5;
      border-bottom: 1px solid #ccc;
    }

    #fieldSelect {
      font-size: 20px;
      padding: 8px;
      width: 100%;
    }

    /* 地図本体は選択リストの高さを引く */
    #map {
      height: calc(100vh - 70px);
    }
  </style>
</head>
<body>

  <!-- 認証後に表示される地図 -->
  <div id="map-container" style="display:none;">

    <!-- ★ 畑選択リスト（追加） -->
    <div id="field-select-container">
      <select id="fieldSelect">
        <option value="">畑を選択してください</option>
      </select>
    </div>

    <!-- 地図本体 -->
    <div id="map"></div>
  </div>

  <script type="module">
    import { verifyLocalAuth } from "/yamamoto-farm-log/common/ui.js";
    import { initMap } from "./map.js";

    window.addEventListener("DOMContentLoaded", async () => {

      // ★ localStorage の認証情報が有効かチェック
      const ok = await verifyLocalAuth();
      if (!ok) return;

      // ★ 認証済み → 地図を表示
      document.getElementById("map-container").style.display = "block";

      // ★ Leaflet 初期化（display:block の後で実行）
      initMap();
    });
  </script>

</body>
</html>