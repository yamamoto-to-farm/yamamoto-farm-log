<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>圃場分析</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- デザイン用CSS -->
  <link rel="stylesheet" href="analysis.css">
</head>

<body>

  <!-- 圃場名 -->
  <h1 id="field-name"></h1>

  <!-- 最新作付けカード -->
  <div class="card">
    <h2>最新作付け</h2>
    <div id="latest-planting" class="info"></div>
  </div>

  <!-- 収穫サマリーカード -->
  <div class="card">
    <h2>収穫サマリー</h2>
    <div id="latest-harvest" class="info"></div>
  </div>

  <!-- 戻るボタン -->
  <button class="back-btn" onclick="location.href='../map/index.html'">
    地図に戻る
  </button>

  <!-- 認証チェック & メイン処理 -->
  <script type="module">
    import { verifyLocalAuth } from "/yamamoto-farm-log/common/ui.js";
    import { initAnalysisPage } from "./analysis.js";

    window.addEventListener("DOMContentLoaded", async () => {

      // ★ localStorage の認証情報が有効かチェック
      const ok = await verifyLocalAuth();
      if (!ok) return;

      // ★ worker → 閲覧禁止
      if (window.currentRole !== "family" && window.currentRole !== "admin") {
        alert("このページは家族のみ閲覧できます");
        location.href = "../map/index.html";
        return;
      }

      // ★ 認証OK → analysis.js のメイン処理へ
      initAnalysisPage();
    });
  </script>

</body>
</html>